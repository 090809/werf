#!/usr/bin/env ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

require 'buildit'

Buildit::Builder.default_opts[:docker_registry] = ENV["DOCKER_REGISTRY"] if ENV.key? "DOCKER_REGISTRY"
Buildit::Builder.default_opts[:build_dir] = "build"
Buildit::Builder.default_opts[:shared_build_dir] = true
Buildit::Builder.default_opts[:cascade_tagging] = true

Buildit::Builder.default_opts[:flush_cache] = true
#Buildit::Builder.default_opts[:log_quiet] = true
Buildit::Builder.default_opts[:log_verbose] = true

ARGV.push "*" unless ARGV.any?

while pattern = ARGV.shift
  exit 1 unless Buildit::Builder.process_directory("apps", pattern).any?
end
