#!/usr/bin/env ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :

require 'rubygems'
require 'dapp'

def net_status_message(exception)
  net_status = exception.net_status.net_status_normalize(context: exception.net_status.delete(:context))
  net_status[:message] || [net_status[:error], net_status[:code]].compact.join(': ')
end

begin
  Dapp::CLI.new.run
rescue Dapp::Error::Shellout => e
  $stderr.puts(net_status_message(e))
  exit 1
rescue Dapp::Error::Base => e
  $stderr.puts(Dapp::Helper::Paint.paint_string(net_status_message(e), :warning))
  exit 1
rescue Interrupt => _e
  $stderr.puts(Dapp::Helper::Paint.paint_string('Interrupted', :warning))
  exit 1
end
