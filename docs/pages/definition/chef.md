---
title: Chef сборщик
sidebar: doc_sidebar
permalink: chef.html
folder: definition
---

### Chef приложение
Chef приложение — это приложение, для сборки которого используются [cookbook приложения](#cookbook-приложения) и [mdapp модули](#mdapp-модуль).

### Cookbook приложения
Cookbook приложения (dapp cookbook) — это основной chef cookbook, связанный с одним [приложением](#приложение).

* Обязательные файлы:
  * metadata.rb
    * Содержит все зависимости, в т.ч. [mdapp модули](#mdapp-модуль).
  * Berksfile
    * Содержит все зависимости, в т.ч. [mdapp модули](#mdapp-модуль).
  * Berksfile.lock
    * Может отсутствовать в [dev режиме](#режим-разработки) — будет создан во время выполнения сборки.
* Структура файлов.
  * Атрибуты.
    * Файлы атрибутов не поддерживаются.
    * Хэш normal-атрибутов задается через [Dappfile](#dappfile), см. [chef.attribute](chef_directives.html#chef-attributes), [chef.\<стадия\>\_attribute](chef_directives.html#chef-<стадия>_attributes).
  * Файлы.
    * Директория files/\<стадия\>/\<рецепт\> — содержит файлы рецепта для стадии, опциональна.
    * Директория files/\<стадия\>/common — содержит общие файлы для стадии, опциональна.
    * Недопустимо наличие одинаковых имен файлов в директории рецепта и common.
  * Шаблоны.
    * Директория templates/\<стадия\>/\<рецепт\> — содержит файлы шаблонов рецепта для стадии, опциональна.
    * Директория templates/\<стадия\>/common — содержит общие файлы шаблонов для стадии, опциональна.
    * Недопустимо наличие одинаковых имен файлов в директории рецепта и common.
  * Рецепты.
    * Директория recipes/\<стадия\> — содержит файлы рецептов для стадии, опциональна.

### Mdapp модуль
Mdapp модуль — это дополнительный chef cookbook, который подключается к сборке [chef приложения](#chef-приложение).

* Обязательные файлы:
  * metadata.rb
* Структура файлов.
  * Файлы атрибутов не поддерживаются.
  * Файлы.
    * Директория files/\<стадия\> — содержит файлы доступные для стадии, опциональна.
    * Директория files/common — содержит файлы доступные для всех стадий, опциональна.
    * Недопустимо наличие одинаковых имен файлов в директории стадии и common.
  * Шаблоны.
    * Директория template/\<стадия\> — содержит файлы доступные для стадии, опциональна.
    * Директория template/common — содержит файлы доступные для всех стадий, опциональна.
    * Недопустимо наличие одинаковых имен файлов в директории стадии и common.
  * Рецепты.
    * Файл recipes/\<стадия\>.rb — файл рецепта модуля для стадии, опционален.

### Стадия cookbook\`а
Стадия cookbook\`а — это часть cookbook\`а, которая используется при сборке стадии для cookbook\`а приложения и mdapp модулей.

* Понятие применимо только к cookbook\`у приложения и mdapp модулям.
* Для всех остальных cookbook\`ов при сборке стадии используется все файлы cookbook\`а.

### Установка стадии cookbook\`а
Установка стадии cookbook\`а — это процесс копирования файлов стадии cookbook\`а во [временное хранилище](#временная-директория-приложения), подключаемое в дальнейшем в контейнер для сборки стадии.

* Установка [cookbook\`а приложения](#cookbook-приложения).
  * Атрибуты.
    * Хэш атрибутов, совмещенных из [chef.attribute](chef_directives.html#chef-attributes) и [chef.\<стадия\>\_attribute](chef_directives.html#chef-<стадия>_attributes), устанавливается в normal-атрибуты, передаваемые через JSON-файл.
    * Файлы атрибутов не поддерживаются.
  * Файлы.
    * Содержимое директории files/\<стадия\>/common при наличии устанавливается в директорию files/default.
    * Содержимое директории files/\<стадия\>/\<рецепт\> устанавливается в директорию files/default.
      * Для каждого включенного рецепта при наличии соответствующей директории.
    * Недопустимо наличие одинаковых имен файлов в директории рецепта и common.
  * Шаблоны.
    * Содержимое директории templates/\<стадия\>/common при наличии устанавливается в директорию templates/default.
    * Содержимое директории templates/\<стадия\>/\<рецепт\> устанавливается в директорию templates/default.
      * Для каждого включенного рецепта при наличии соответствующей директории.
    * Недопустимо наличие одинаковых имен файлов в директории рецепта и common.
  * Рецепты.
    * Файл recipes/\<стадия\>/\<рецепт\>.rb устанавливается в recipes/\<рецепт\>.rb.
      * Для каждого включенного рецепта при его наличии.
    * При отсутствии рецептов генерируется пустой рецепт recipes/void.rb.
      * Отсутствие рецептов подразумевает одно из условий:
        * отсутствие включенных рецептов в конфигурации;
        * отсутствие файлов рецептов (recipes/\<стадия\>/\<рецепт\>.rb) для всех включенных в конфигурации рецептов.
      * Это позволяет активировать атрибуты, объявленные в данном cookbook\`е.
* Установка [mdapp модуля](#mdapp-модуль).
  * Файлы атрибутов не поддерживаются.
  * Файлы.
    * Содержимое директории files/common при наличии устанавливается в директорию files/default.
    * Содержимое директории files/\<стадия\> при наличии устанавливается в директорию files/default.
    * Недопустимо наличие одинаковых имен файлов в директории стадии и common.
  * Шаблоны.
    * Содержимое директории templates/common при наличии устанавливается в директорию templates/default.
    * Содержимое директории templates/\<стадия\> при наличии устанавливается в директорию templates/default.
    * Недопустимо наличие одинаковых имен файлов в директории стадии и common.
  * Рецепты.
    * Файл recipes/\<стадия\>.rb при наличии устанавливается в recipes/\<стадия\>.rb.
    * При отсутствии рецепта генерируется пустой рецепт recipes/void.rb.
      * Это позволяет активировать атрибуты, объявленные в данном cookbook\`е, при отсутствии рецепта.
* Остальныe cookbook\`и устанавливаются без изменений, "как есть".

### Контрольная сумма cookbook\`ов стадии
Контрольная сумма cookbook\`ов стадии — это контрольная сумма всех [установленных файлов cookbook\`ов](#установка-стадии-cookbookа) для данной стадии.

### Дерево cookbooks
Дерево cookbooks — это результат выполнения berks vendor в chef приложении.